{% extends "base.jinja" %}

{% block content %}
<h1>Add an Entry for {{person.first_name}} </h1>

<form method=POST id="entry-form">{% csrf_token %}
    <textarea class="content" name="content"></textarea>
    
    <h4>Add Feedback that {{person.first_name}} gave:</h4>
    <ul id="feedback-field-list">
        <li class="feedback-field">
            <textarea class="feedback-content" /></textarea>
            for
            <select class="feedback-recipient">
                {% for recipient in people %}
                    {% if recipient.id != person.id %}
                      <option value="{{recipient.id}}">{{recipient.full_name}}</option>
                    {% endif %}
                {% endfor %}
            </select>
        </li>
    <ul>
    
    <input type="hidden" value="" id="feedback-field" name="feedback" />
    <input class="btn" type="submit" value="Save" />
</form>

<script type="text/javascript">
    $(function(){
        var fields = [];
        $('#entry-form').submit(function(){
          $('.feedback-field').each(function(){
              var content = $(this).find(".feedback-content").val();
              var recipient = $(this).find(".feedback-recipient").val();

              fields.push({
                  content: content,
                  recipient: recipient
              });
          });
        
          $("#feedback-field").val(JSON.stringify(fields));
        });
    });
</script>

{% endblock %}


